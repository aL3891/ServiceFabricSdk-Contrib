<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<UsingTask TaskName="ServiceFabricSdkContrib.MsBuild.PackageSymLinkTask" Architecture="x64" AssemblyFile="ServiceFabricSdkContrib.MsBuild.dll" />
	<UsingTask TaskName="ServiceFabricSdkContrib.MsBuild.UpdateApplicationVersionGitTask" Architecture="x64" AssemblyFile="ServiceFabricSdkContrib.MsBuild.dll" />
	<UsingTask TaskName="ServiceFabricSdkContrib.MsBuild.CleanServiceFabricApplicationTask" Architecture="x64" AssemblyFile="ServiceFabricSdkContrib.MsBuild.dll" />


	<Target Name="PackageSymLink" AfterTargets="ResolveProjectReferences" DependsOnTargets="ValidatePackageSettings;GetServiceProjectReferences">
		<PackageSymLinkTask
      ProjectReferences="@(_ResolvedProjectReferencePaths)"
      ServiceProjectReferences="@(ServiceProjectReference)"
      ServicePackageRootFolder="$(ServicePackageRootFolder)"
      ApplicationManifestPath="$(ApplicationManifestFilePath)"
      IncludeInPackagePaths="@(IncludeInPackagePaths)"
      PackageBehavior="$(PackageBehavior)"
      ProjectPath="$(MSBuildProjectFullPath)"
      PackageLocation="$(PackageLocation)"
      Configuration="$(Configuration)"
      Platform="$(Platform)"
	    BasePath="$(MSBuildProjectFullPath)"
	    IntermediateOutputPath="$(IntermediateOutputPath)">
		</PackageSymLinkTask>
	</Target>

	<Target Name="UpdateApplicationVersionGit" Condition="$(UpdateApplicationVersionGit) == 'true'" AfterTargets="PackageSymLink">
		<UpdateApplicationVersionGitTask
      ProjectReferences="@(_ResolvedProjectReferencePaths)"
      ServiceProjectReferences="@(ServiceProjectReference)"
      ApplicationManifestPath="$(ApplicationManifestFilePath)"
      ProjectPath="$(MSBuildProjectFullPath)"
      PackageLocation="$(PackageLocation)">
		</UpdateApplicationVersionGitTask>
	</Target>

	<Target Name="CleanServiceFabricApp" AfterTargets="IncludePackageLocationOnClean" >
		<CleanServiceFabricApplicationTask
			ProjectPath="$(MSBuildProjectFullPath)"
			CleanItems="@(Clean)">
			<Output TaskParameter="SymlinkItems" ItemName="SymlinkItems"/>
		</CleanServiceFabricApplicationTask>

		<ItemGroup>
			<Clean Remove="@(SymlinkItems)"/>
		</ItemGroup>
	</Target>
</Project>