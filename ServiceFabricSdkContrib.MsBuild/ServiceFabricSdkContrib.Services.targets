<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<UsingTask TaskName="ServiceFabricSdkContrib.MsBuild.UpdateServiceVersionGitTask" Architecture="x64" AssemblyFile="ServiceFabricSdkContrib.MsBuild.dll" />
	<UsingTask TaskName="ServiceFabricSdkContrib.MsBuild.PackageFabricServiceTask" Architecture="x64" AssemblyFile="ServiceFabricSdkContrib.MsBuild.dll" />

	<Target Name="PackageFabricService" AfterTargets="Build">
		<PropertyGroup>
			<UseHardlinksForServiceFabricIfPossible Condition="$(UseHardlinksForServiceFabricIfPossible) == ''">True</UseHardlinksForServiceFabricIfPossible>
		</PropertyGroup>
		
		<PackageFabricServiceTask
      Configuration="$(Configuration)"
			TargetDir="$(TargetDir)"
	    ProjectPath="$(MSBuildProjectFullPath)">
			<Output TaskParameter="SourceFiles" ItemName="PkgSourceFiles"/>
			<Output TaskParameter="DestinationFiles" ItemName="PkgDestinationFiles"/>
		</PackageFabricServiceTask>
		<Copy SourceFiles="@(PkgSourceFiles)" DestinationFiles="@(PkgDestinationFiles)" SkipUnchangedFiles="$(SkipCopyUnchangedFiles)" UseHardlinksIfPossible="$(UseHardlinksForServiceFabricIfPossible)" />
	</Target>

	<Target Name="UpdateServiceVersionGit" Condition="$(UpdateServiceVersionGit) == 'True'" AfterTargets="PackageFabricService">
		<PropertyGroup>
			<CheckIndividualSFServicePackages Condition="$(CheckIndividualSFServicePackages) == ''">False</CheckIndividualSFServicePackages>
		</PropertyGroup>
		<UpdateServiceVersionGitTask
      BasePath="$(MSBuildProjectFullPath)"
			Configuration="$(Configuration)"
      TargetDir="$(TargetDir)"
			CheckIndividualPackages="$(CheckIndividualSFServicePackages)"
			ProjectReferences="@(_ResolvedProjectReferencePaths)">
		</UpdateServiceVersionGitTask>
	</Target>
</Project>